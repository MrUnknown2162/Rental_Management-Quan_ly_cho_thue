<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Dashboard quáº£n lÃ½</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="assets/css/cute.css">

  <style>
    .dashboard-card {
      cursor: pointer;
      transition: all 0.3s ease;
      border-radius: 20px;
    }
    .dashboard-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 12px 25px rgba(255,105,180,0.4);
    }
  </style>
</head>
<body>
<script>
if (localStorage.getItem("adminLogged") !== "true") {
  alert("Vui lÃ²ng Ä‘Äƒng nháº­p quáº£n trá»‹");
  window.location.href = "admin-login.html";
}
</script>

<script>
const CURRENT_USER = JSON.parse(localStorage.getItem("currentUser"));
if (!CURRENT_USER || CURRENT_USER.role !== "admin") {
  alert("Báº¡n khÃ´ng cÃ³ quyá»n truy cáº­p trang quáº£n trá»‹");
  window.location.href = "login.html";
}
</script>


<!-- ================= NAVBAR ================= -->
<nav class="navbar navbar-expand-lg">
  <div class="container">
    <a class="navbar-brand fw-bold" href="index.html">QARent</a>
    <div>
      <a href="index.html" class="btn btn-light me-2">Trang chá»§</a>
      <a href="assets.html" class="btn btn-light me-2">TÃ i sáº£n</a>
      <a href="dashboard.html" class="btn btn-light active me-2">Dashboard</a>
      <a href="login.html" class="btn btn-light">ÄÄƒng xuáº¥t</a>
    </div>
  </div>
</nav>

<!-- ================= TIÃŠU Äá»€ ================= -->
<section class="container py-5">
  <h1 class="fw-bold">ğŸ“Š Dashboard quáº£n lÃ½</h1>
  <p class="text-muted">Tá»•ng quan há»‡ thá»‘ng quáº£n lÃ½ cho thuÃª</p>
</section>

<!-- ================= CARD THá»NG KÃŠ ================= -->
<section class="container pb-5">
  <div class="row">

    <!-- Tá»•ng tÃ i sáº£n -->
    <div class="col-md-3 mb-4">
      <div class="card p-4 text-center dashboard-card" onclick="openDetail('assets')">
        <h6>Tá»•ng tÃ i sáº£n</h6>
        <h2 class="fw-bold text-danger">6</h2>
        <p>NhÃ  â€¢ Chung cÆ° â€¢ Xe</p>
      </div>
    </div>

    <!-- Äang cho thuÃª -->
    <div class="col-md-3 mb-4">
      <div class="card p-4 text-center dashboard-card" onclick="openDetail('renting')">
        <h6>Äang cho thuÃª</h6>
        <h2 class="fw-bold text-success">3</h2>
        <p>Há»£p Ä‘á»“ng hiá»‡u lá»±c</p>
      </div>
    </div>

    <!-- Táº¡m háº¿t -->
    <div class="col-md-3 mb-4">
      <div class="card p-4 text-center dashboard-card" onclick="openDetail('unavailable')">
        <h6>Táº¡m háº¿t</h6>
        <h2 class="fw-bold text-warning">3</h2>
        <p>ChÆ°a kháº£ dá»¥ng</p>
      </div>
    </div>

    <!-- NgÆ°á»i dÃ¹ng -->
    <div class="col-md-3 mb-4">
      <div class="card p-4 text-center dashboard-card" onclick="openDetail('users')">
        <h6>NgÆ°á»i dÃ¹ng</h6>
        <h2 class="fw-bold text-primary">?</h2>
        <p>ÄÃ£ Ä‘Äƒng kÃ½</p>
      </div>
    </div>

  </div>
</section>

<!-- ================= MODAL CHI TIáº¾T ================= -->
<div class="modal fade" id="detailModal" tabindex="-1">
  <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalTitle"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="modalBody"></div>
    </div>
  </div>
</div>

<!-- ================= FOOTER ================= -->
<footer class="text-center py-4">
  <p>Â© 2025 Há»‡ thá»‘ng quáº£n lÃ½ cho thuÃª</p>
</footer>

<!-- ================= SCRIPT ================= -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ===== Dá»® LIá»†U GIáº¢ Láº¬P ===== */

const allAssets = [
  { name: "NhÃ  phá»‘ Quáº­n 1", type: "NhÃ ", status: "Äang cho thuÃª" },
  { name: "NhÃ  nguyÃªn cÄƒn Thá»§ Äá»©c", type: "NhÃ ", status: "Táº¡m háº¿t" },
  { name: "Chung cÆ° Quáº­n 7", type: "Chung cÆ°", status: "Äang cho thuÃª" },
  { name: "Chung cÆ° BÃ¬nh Tháº¡nh", type: "Chung cÆ°", status: "Táº¡m háº¿t" },
  { name: "Toyota Vios 2022", type: "Xe", status: "Äang cho thuÃª" },
  { name: "Honda City 2023", type: "Xe", status: "Táº¡m háº¿t" }
];

const rentingContracts = [
  {
    contract: "HD001",
    customer: "Nguyá»…n VÄƒn A",
    phone: "0901234567",
    email: "vana@gmail.com",
    asset: "NhÃ  phá»‘ Quáº­n 1",
    time: "01/01/2025 â€“ 01/03/2025"
  },
  {
    contract: "HD002",
    customer: "Tráº§n Thá»‹ B",
    phone: "0987654321",
    email: "thib@gmail.com",
    asset: "Toyota Vios 2022",
    time: "10/02/2025 â€“ 20/02/2025"
  }
];

/* ===== HÃ€M Má» CHI TIáº¾T ===== */

function openDetail(type) {
  let title = "";
  let html = "";

  if (type === "assets") {
    title = "ğŸ“¦ Tá»•ng tÃ i sáº£n trong há»‡ thá»‘ng";
    html = "<ul>";
    allAssets.forEach(a => {
      html += `<li><b>${a.name}</b> (${a.type}) â€“ ${a.status}</li>`;
    });
    html += "</ul>";
  }

  if (type === "unavailable") {
    title = "â›” TÃ i sáº£n táº¡m háº¿t";
    html = "<ul>";
    allAssets
      .filter(a => a.status === "Táº¡m háº¿t")
      .forEach(a => html += `<li>${a.name} (${a.type})</li>`);
    html += "</ul>";
  }

  if (type === "renting") {
    title = "ğŸ“„ TÃ i sáº£n Ä‘ang cho thuÃª";
    html = `
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>MÃ£ HÄ</th>
            <th>KhÃ¡ch thuÃª</th>
            <th>LiÃªn há»‡</th>
            <th>TÃ i sáº£n</th>
            <th>Thá»i gian</th>
          </tr>
        </thead>
        <tbody>`;
    rentingContracts.forEach(c => {
      html += `
        <tr>
          <td>${c.contract}</td>
          <td>${c.customer}</td>
          <td>${c.phone}<br>${c.email}</td>
          <td>${c.asset}</td>
          <td>${c.time}</td>
        </tr>`;
    });
    html += "</tbody></table>";
  }

  if (type === "users") {
    title = "ğŸ‘¤ NgÆ°á»i dÃ¹ng Ä‘Ã£ Ä‘Äƒng kÃ½";
    let users = JSON.parse(localStorage.getItem("users")) || [];
    html = users.length
      ? "<ol>" + users.map(u => `<li>${u}</li>`).join("") + "</ol>"
      : "<p>ChÆ°a cÃ³ ngÆ°á»i dÃ¹ng Ä‘Äƒng kÃ½.</p>";
  }

  document.getElementById("modalTitle").innerHTML = title;
  document.getElementById("modalBody").innerHTML = html;

  new bootstrap.Modal(document.getElementById("detailModal")).show();
}
</script>
<script>
function updateContractStatus(index, status) {
  let contracts = JSON.parse(localStorage.getItem("contracts")) || [];
  contracts[index].status = status;

  // Gá»­i thÃ´ng bÃ¡o cho user
  let notifications = JSON.parse(localStorage.getItem("notifications")) || [];
  notifications.unshift({
    user: contracts[index].user,
    message: `Há»£p Ä‘á»“ng ${contracts[index].asset} Ä‘Ã£ ${status}`,
    time: new Date().toLocaleString()
  });

  localStorage.setItem("contracts", JSON.stringify(contracts));
  localStorage.setItem("notifications", JSON.stringify(notifications));

  alert("ÄÃ£ xá»­ lÃ½ há»£p Ä‘á»“ng");
}
</script>
<script>
/* ================= ADMIN DASHBOARD ================= */

let contracts = JSON.parse(localStorage.getItem("contracts")) || [];
let users = JSON.parse(localStorage.getItem("users")) || [];

document.getElementById("totalUsers").innerText = users.length;
document.getElementById("pendingContracts").innerText =
  contracts.filter(c => c.status === "Chá» duyá»‡t").length;

/* Hiá»ƒn thá»‹ há»£p Ä‘á»“ng */
function renderContracts() {
  const list = document.getElementById("contractList");
  list.innerHTML = "";

  contracts.forEach((c, index) => {
    list.innerHTML += `
      <tr>
        <td>${c.user}</td>
        <td>${c.assetId}</td>
        <td>${c.start} â†’ ${c.end}</td>
        <td>${c.status}</td>
        <td>
          <button class="btn btn-success btn-sm" onclick="approve(${index})">Duyá»‡t</button>
          <button class="btn btn-danger btn-sm" onclick="reject(${index})">Tá»« chá»‘i</button>
        </td>
      </tr>
    `;
  });
}

function approve(i) {
  contracts[i].status = "ÄÃ£ duyá»‡t";
  notifyUser(contracts[i].user, "Há»£p Ä‘á»“ng Ä‘Ã£ Ä‘Æ°á»£c duyá»‡t");
}

function reject(i) {
  contracts[i].status = "Tá»« chá»‘i";
  notifyUser(contracts[i].user, "Há»£p Ä‘á»“ng bá»‹ tá»« chá»‘i");
}

function notifyUser(user, message) {
  let notifications = JSON.parse(localStorage.getItem("notifications")) || [];
  notifications.push({
    user,
    message,
    time: new Date().toLocaleString()
  });
  localStorage.setItem("notifications", JSON.stringify(notifications));
  localStorage.setItem("contracts", JSON.stringify(contracts));
  renderContracts();
}

renderContracts();
</script>
<h3 class="fw-bold mb-3">ğŸ“„ Danh sÃ¡ch há»£p Ä‘á»“ng thuÃª</h3>

<table class="table table-bordered">
  <thead>
    <tr>
      <th>KhÃ¡ch thuÃª</th>
      <th>TÃ i sáº£n</th>
      <th>Thá»i gian</th>
      <th>Tráº¡ng thÃ¡i</th>
      <th>Thao tÃ¡c</th>
    </tr>
  </thead>
  <tbody id="contractTable"></tbody>
</table>

</body>
</html>
