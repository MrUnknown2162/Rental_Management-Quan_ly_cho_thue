<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ÄÄƒng nháº­p - QARent</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="assets/css/cute.css">
</head>
<body class="bg-light">

<div class="container d-flex justify-content-center align-items-center vh-100">
  <div class="card shadow p-4" style="width:420px">

    <h3 class="fw-bold text-center mb-4">ÄÄƒng nháº­p QARent</h3>

    <form id="loginForm">
      <input id="loginEmail" type="email" class="form-control mb-3"
             placeholder="Email" required>

      <input id="loginPassword" type="password" class="form-control mb-3"
             placeholder="Máº­t kháº©u" required>

      <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" id="remember">
        <label class="form-check-label">Nhá»› tÃ i khoáº£n</label>
      </div>

      <button id="loginBtn" class="btn btn-primary w-100">
        ÄÄƒng nháº­p
      </button>
    </form>

    <p class="text-center mt-3">
      ChÆ°a cÃ³ tÃ i khoáº£n?
      <a href="register.html">ÄÄƒng kÃ½</a>
    </p>

  </div>
</div>

<!-- MODAL -->
<div class="modal fade" id="alertModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">QARent thÃ´ng bÃ¡o</h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center fs-5" id="alertMessage"></div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const form = document.getElementById("loginForm");
  const btn = document.getElementById("loginBtn");
  const modal = new bootstrap.Modal(document.getElementById("alertModal"));

  function showAlert(msg) {
    document.getElementById("alertMessage").innerText = msg;
    modal.show();
  }

  /* ===== AUTO FILL ===== */
  const rememberUser = JSON.parse(localStorage.getItem("rememberUser"));
  if (rememberUser) {
    loginEmail.value = rememberUser.email;
    loginPassword.value = rememberUser.password;
    remember.checked = true;
  }

  form.addEventListener("submit", e => {
    e.preventDefault();
    btn.disabled = true;

    const users = JSON.parse(localStorage.getItem("users")) || [];
    const emailInput = loginEmail.value.trim();   // ğŸ‘ˆ FIX
    const passwordInput = loginPassword.value;

    const user = users.find(u => u.email === emailInput);

    if (!user) {
      showAlert("TÃ i khoáº£n chÆ°a Ä‘Äƒng kÃ½");
      btn.disabled = false;
      return;
    }

    if (user.password !== passwordInput) {
      showAlert("Sai máº­t kháº©u");
      btn.disabled = false;
      return;
    }

    /* ===== FIX ROLE ===== */
    if (!user.role || user.role.toLowerCase() !== "admin" && user.role !== "user") {
      user.role = "admin"; // Ã©p admin cho tÃ i khoáº£n Ä‘Ã£ Ä‘Äƒng kÃ½ admin trÆ°á»›c Ä‘Ã³
    }

    localStorage.setItem("currentUser", JSON.stringify(user));

    /* ===== REMEMBER (NHáº¸) ===== */
    if (remember.checked) {
      localStorage.setItem("rememberUser", JSON.stringify({
        email: user.email,
        password: user.password
      }));
    } else {
      localStorage.removeItem("rememberUser");
    }

    showAlert("ğŸ‰ ChÃ o má»«ng báº¡n Ä‘áº¿n vá»›i QARent!");

    setTimeout(() => {
      window.location.href =
        user.role === "admin" ? "dashboard.html" : "index.html";
    }, 600);
  });

});
</script>

</body>
</html>
